# 시뮬레이션 로그 시스템 아키텍처

## 데이터 흐름 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                         스크립트 실행                              │
├─────────────────────────────────────────────────────────────────┤
│  Block A Script         Block B Script         Block C Script   │
│  ┌─────────────┐       ┌─────────────┐       ┌─────────────┐  │
│  │log "메시지1" │       │log "메시지2" │       │log "메시지3" │  │
│  └──────┬──────┘       └──────┬──────┘       └──────┬──────┘  │
│         │                      │                      │         │
│         ▼                      ▼                      ▼         │
│  ┌─────────────┐       ┌─────────────┐       ┌─────────────┐  │
│  │ScriptExecutor│       │ScriptExecutor│       │ScriptExecutor│  │
│  │simulation_logs│      │simulation_logs│      │simulation_logs│ │
│  └──────┬──────┘       └──────┬──────┘       └──────┬──────┘  │
└─────────┼──────────────────────┼──────────────────────┼─────────┘
          │                      │                      │
          └──────────────────────┴──────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────┐
│                      시뮬레이션 엔진                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  collect_script_logs()                                   │   │
│  │  - 모든 블록에서 로그 수집                                 │   │
│  │  - 시간순 정렬                                           │   │
│  │  - 중복 제거 (필요시)                                     │   │
│  └────────────────────────┬─────────────────────────────────┘   │
└───────────────────────────┼─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                         API 응답                                 │
├─────────────────────────────────────────────────────────────────┤
│  {                                                              │
│    "time": 10.5,                                               │
│    "active_entities": [...],                                    │
│    "script_logs": [                                            │
│      {"time": 1.0, "block": "Block A", "message": "메시지1"},  │
│      {"time": 2.5, "block": "Block B", "message": "메시지2"},  │
│      {"time": 3.0, "block": "Block C", "message": "메시지3"}   │
│    ]                                                            │
│  }                                                              │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                      프론트엔드                                  │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  useSimulation.js                                       │   │
│  │  - updateSimulationState(result)                        │   │
│  │  - result.script_logs 처리                              │   │
│  └────────────────────────┬─────────────────────────────────┘   │
│                           │                                      │
│                           ▼                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  useSimulationLogs.js (Composable)                      │   │
│  │  - logs: ref([])                                        │   │
│  │  - addLogs(newLogs)                                     │   │
│  │  - clearLogs()                                          │   │
│  │  - exportLogs()                                         │   │
│  └────────────────────────┬─────────────────────────────────┘   │
│                           │                                      │
│                           ▼                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  LogPanel.vue (UI Component)                            │   │
│  │  ┌───────────────────────────────────────────────────┐  │   │
│  │  │ 📋 시뮬레이션 로그                    [🗑️][💾][▼] │  │   │
│  │  ├───────────────────────────────────────────────────┤  │   │
│  │  │ 🔍 [검색...          ] [모든 블록 ▼]              │  │   │
│  │  ├───────────────────────────────────────────────────┤  │   │
│  │  │ [1.0s] [Block A] 메시지1                         │  │   │
│  │  │ [2.5s] [Block B] 메시지2                         │  │   │
│  │  │ [3.0s] [Block C] 메시지3                         │  │   │
│  │  └───────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 주요 컴포넌트 설명

### 1. 백엔드 컴포넌트

#### SimpleScriptExecutor
- **역할**: 스크립트 실행 및 로그 수집
- **주요 속성**: `simulation_logs: List[Dict]`
- **주요 메서드**:
  - `execute_log()`: log 명령어 실행 및 저장
  - `get_simulation_logs()`: 수집된 로그 반환

#### SimpleBlock
- **역할**: 블록별 스크립트 실행 관리
- **주요 메서드**:
  - `get_script_logs()`: 블록의 스크립트 로그 반환

#### SimpleSimulationEngine
- **역할**: 전체 시뮬레이션 관리 및 로그 집계
- **주요 메서드**:
  - `collect_script_logs()`: 모든 블록의 로그 수집 및 정렬

### 2. 프론트엔드 컴포넌트

#### useSimulationLogs (Composable)
- **역할**: 로그 상태 관리
- **주요 기능**:
  - 로그 저장 및 관리
  - 최대 로그 수 제한
  - 로그 내보내기

#### LogPanel.vue
- **역할**: 로그 UI 표시
- **주요 기능**:
  - 실시간 로그 표시
  - 필터링 및 검색
  - 최소화/최대화
  - 내보내기

## 구현 시 주의사항

### 성능 최적화
1. **로그 수 제한**: 메모리 사용량 관리
2. **가상 스크롤**: 대량 로그 렌더링 최적화
3. **디바운싱**: 검색 입력 최적화

### 데이터 일관성
1. **시간 동기화**: 백엔드와 프론트엔드 시간 일치
2. **순서 보장**: 로그 순서 유지
3. **중복 방지**: 동일 로그 중복 제거

### 사용자 경험
1. **자동 스크롤**: 새 로그 추가 시 자동 스크롤
2. **하이라이팅**: 검색어 하이라이팅
3. **반응형**: 화면 크기에 따른 자동 조정