# 블록 상태 속성 아키텍처

## 시스템 구조

```
┌─────────────────────────────────────────────────────────────┐
│                       Frontend (Vue 3)                       │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐    ┌──────────────────┐               │
│  │  CanvasArea.vue │    │ ScriptEditor.vue │               │
│  │  - 상태 표시    │    │  - 구문 강조     │               │
│  │  - 실시간 갱신  │    │  - 명령어 검증   │               │
│  └────────┬────────┘    └──────────────────┘               │
│           │                                                  │
│  ┌────────▼─────────────────────────────────┐               │
│  │              App.vue                      │               │
│  │  - updateBlockWarnings()                  │               │
│  │  - 블록 상태 동기화                        │               │
│  └──────────────────────────────────────────┘               │
└─────────────────────┬───────────────────────────────────────┘
                      │ HTTP API
┌─────────────────────▼───────────────────────────────────────┐
│                       Backend (Python)                       │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────┐               │
│  │         SimpleScriptExecutor            │               │
│  │  - execute_command()                    │               │
│  │  - execute_block_status()               │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                          │
│  ┌────────────────▼────────────────────────┐               │
│  │           IndependentBlock              │               │
│  │  - status: Optional[str]                │               │
│  │  - set_status(value: str)              │               │
│  │  - get_status() -> Optional[str]       │               │
│  └─────────────────────────────────────────┘               │
└─────────────────────────────────────────────────────────────┘
```

## 명령어 처리 흐름

```
1. 스크립트 입력: "공정1 status = 'running'"
                      │
2. SimpleScriptExecutor.execute_command()
                      │
3. 명령어 파싱 및 검증
   - 블록 이름: "공정1"
   - 명령어: "status"
   - 값: "running"
                      │
4. execute_block_status("공정1", "running")
                      │
5. block.set_status("running")
                      │
6. 상태 변경 로깅
                      │
7. 시뮬레이션 결과에 포함
                      │
8. Frontend 업데이트
```

## 데이터 모델

### 백엔드 블록 상태
```python
class ProcessBlockConfig(BaseModel):
    id: str
    name: str
    type: str = "process"
    x: int
    y: int
    status: Optional[str] = None  # 새로 추가
    # ... 기타 필드
```

### 프론트엔드 블록 상태
```javascript
{
  id: "1",
  name: "공정1",
  x: 100,
  y: 100,
  status: "running",  // 새로 추가
  // ... 기타 속성
}
```

## 스크립트 명령어 형식

### 지원되는 형식
```
블록이름 status = "값"
블록이름 status = '값'
블록이름 status = "여러 단어로 된 값"
```

### 예시
```
공정1 status = "running"
공정2 status = "idle"
배출 status = "maintenance required"
투입 status = "준비중"
```

## UI 표시 방법

```
┌──────────────────┐
│     공정1        │  <- 블록 이름
│   [running]      │  <- 상태 표시 (이탤릭체)
│     1/5          │  <- 용량 표시
└──────────────────┘
```

### 상태별 스타일 (향후 확장 가능)
- `running`: 녹색 배경
- `idle`: 회색 배경
- `maintenance`: 주황색 배경
- 기타: 기본 스타일

## 에러 처리

### 가능한 에러 상황
1. 존재하지 않는 블록 이름
   - 에러: "Block '잘못된이름' not found"

2. 잘못된 명령어 형식
   - 에러: "올바른 형식: 블록이름 status = \"값\""

3. 빈 상태 값
   - 에러: "상태 값은 비어있을 수 없습니다"

## 성능 고려사항

1. **상태 변경 빈도**
   - 매 스텝마다 변경될 수 있음
   - 불필요한 UI 업데이트 방지 필요

2. **메모리 사용**
   - 상태 문자열 길이 제한 없음
   - 합리적인 길이 권장 (50자 이내)

3. **네트워크 트래픽**
   - 매 스텝 결과에 상태 포함
   - 상태가 변경된 블록만 전송 최적화 가능

## 확장 가능성

### 단기 확장
1. 상태 기반 조건문
   ```
   if 공정1 status = "idle"
       go to 공정1.L
   ```

2. 상태 이력 추적
   - 상태 변경 시간 기록
   - 상태 전환 횟수 통계

### 장기 확장
1. 다중 상태 속성
   - 여러 개의 상태를 동시에 가질 수 있도록 확장

2. 상태 전환 규칙
   - 특정 상태에서만 다른 상태로 전환 가능하도록 제한

3. 상태 기반 시각화
   - 상태별 블록 색상 자동 변경
   - 상태 아이콘 표시

## 테스트 계획

### 단위 테스트
1. 블록 상태 설정/조회 테스트
2. 스크립트 명령어 파싱 테스트
3. 에러 처리 테스트

### 통합 테스트
1. 시뮬레이션 중 상태 변경 테스트
2. 여러 블록의 동시 상태 변경
3. 저장/로드 시 상태 유지 테스트

### 시나리오 테스트
```
1. 공정1 생성
2. 공정1 status = "준비중"
3. 엔티티 도착 시 공정1 status = "가동중"
4. 처리 완료 시 공정1 status = "대기중"
5. 시뮬레이션 저장
6. 시뮬레이션 로드 및 상태 확인
```