# 공정 시뮬레이션 웹 애플리케이션 PRD
## Product Requirements Document

---

## 1. 제품 개요

### 1.1 제품 비전
복잡한 제조 공정을 시각적으로 모델링하고 실시간 시뮬레이션을 통해 공정 최적화를 지원하는 직관적인 웹 애플리케이션

### 1.2 제품 목표
- **효율성**: 드래그 앤 드롭 기반의 직관적인 공정 설계
- **정확성**: SimPy 기반 이산 사건 시뮬레이션으로 정밀한 분석
- **유연성**: 조건부 로직과 신호 시스템으로 복잡한 공정 표현
- **실시간성**: 단계별 시뮬레이션과 즉시 피드백

### 1.3 대상 사용자
- **주 사용자**: 제조 엔지니어, 공정 설계자, 생산 관리자
- **부 사용자**: 시스템 분석가, 컨설턴트, 학술 연구자

---

## 2. 핵심 기능 요구사항

### 2.1 공정 설계 기능

#### 2.1.1 블록 관리
- **필수 기능**:
  - 블록 생성, 삭제, 복사 (Ctrl+D)
  - 드래그 앤 드롭으로 위치 이동
  - 블록 이름 및 최대 용량 설정
  - 블록 크기 동적 조정

- **블록 타입**:
  - **투입 블록**: 엔티티 생성 시작점
  - **공정 블록**: 실제 작업 수행 단위
  - **배출 블록**: 엔티티 종료점

#### 2.1.2 연결점(커넥터) 관리
- 블록 내 다중 연결점 지원
- 연결점별 독립적인 액션 설정
- 시각적 연결선 자동 생성
- 연결점 이름 커스터마이징

#### 2.1.3 액션 시스템
- **기본 액션 타입**:
  - `delay`: 작업 시간 지연
  - `signal_update`: 신호 값 변경
  - `signal_check`: 신호 조건 확인
  - `signal_wait`: 신호 대기
  - `action_jump`: 다른 액션으로 이동
  - `route_to_connector`: 연결점 라우팅
  - `conditional_branch`: 조건부 분기

### 2.2 시뮬레이션 실행 기능

#### 2.2.1 실행 모드
- **전체 실행**: 설정된 조건까지 완전 실행
- **단계별 실행**: 엔티티 이동 단위로 스텝 실행
- **이전 단계**: 히스토리 기반 되돌리기
- **초기화**: 시뮬레이션 상태 완전 리셋

#### 2.2.2 중지 조건
- **수량 기반**: 지정된 엔티티 개수 처리 시 중지
- **시간 기반**: 설정된 시뮬레이션 시간 도달 시 중지

#### 2.2.3 실시간 모니터링
- 현재 처리 중인 엔티티 수 표시
- 시뮬레이션 진행 시간 표시
- 완료된 스텝 수 카운트
- 엔티티 위치 실시간 추적

### 2.3 신호 시스템

#### 2.3.1 글로벌 신호 관리
- 신호 생성, 수정, 삭제
- 신호 타입: Boolean, String, Number
- 신호 초기값 설정
- 실시간 신호 값 모니터링

#### 2.3.2 신호 기반 제어
- 조건부 엔티티 투입 제어
- 신호 값에 따른 라우팅 변경
- 신호 대기 기반 동기화

### 2.4 스크립트 시스템

#### 2.4.1 고급 스크립트 편집기
- 구문 강조 및 실시간 검증
- 자동 완성 (신호명, 블록명)
- 행 번호 표시 및 오류 위치 표시
- TAB 키 지원 및 들여쓰기 관리

#### 2.4.2 스크립트 문법
```
delay 5                    # 5초 딜레이
신호명 = true              # 신호 값 변경
if 신호명 = true           # 조건부 실행
    go to 블록명.커넥터명   # 라우팅
    jump to 1              # 라인 점프
wait 신호명 = true         # 신호 대기
// 주석                    # 주석 처리
```

### 2.5 설정 관리

#### 2.5.1 화면 설정
- 블록 크기 조정 (50-200 픽셀)
- 폰트 크기 조정 (8-20 픽셀)
- 캔버스 확대/축소 및 드래그

#### 2.5.2 파일 관리
- JSON 형태 설정 저장/불러오기
- 자동 저장 (1초 디바운스)
- 설정 내보내기/가져오기

---

## 3. 사용자 인터페이스 요구사항

### 3.1 레이아웃 구조
- **메인 캔버스**: 중앙 영역, 전체 화면의 70%
- **설정 사이드바**: 우측 영역, 토글 가능
- **제어 패널**: 상단 고정, 시뮬레이션 제어
- **신호 패널**: 하단 또는 별도 탭

### 3.2 반응형 디자인
- 최소 해상도: 1024x768
- 캔버스 동적 크기 조정
- 사이드바 접기/펼치기 기능

### 3.3 사용성 요구사항
- **직관적 조작**: 드래그 앤 드롭 중심 인터페이스
- **즉시 피드백**: 모든 액션에 대한 즉각적 시각적 반응
- **키보드 단축키**: 자주 사용하는 기능의 단축키 지원
- **도움말 시스템**: 컨텍스트 기반 도움말 제공

---

## 4. 기술적 요구사항

### 4.1 프론트엔드 기술 스택
- **프레임워크**: Vue.js 3 (Composition API)
- **캔버스 라이브러리**: Konva.js (2D 렌더링)
- **빌드 도구**: Vite
- **스타일링**: CSS3 (Grid, Flexbox)

### 4.2 백엔드 기술 스택
- **웹 프레임워크**: FastAPI
- **시뮬레이션 엔진**: SimPy (이산 사건 시뮬레이션)
- **데이터 검증**: Pydantic
- **서버**: uvicorn (ASGI)

### 4.3 성능 요구사항
- **응답 시간**: API 호출 < 100ms
- **메모리 사용량**: 브라우저 < 500MB
- **동시 사용자**: 10명 (단일 서버)
- **블록 수 제한**: 최대 100개 블록

### 4.4 호환성 요구사항
- **브라우저**: Chrome 80+, Firefox 75+, Safari 14+
- **운영체제**: Windows 10+, macOS 10.15+, Ubuntu 20.04+
- **Python 버전**: 3.8+
- **Node.js 버전**: 16+

---

## 5. 데이터 모델

### 5.1 블록 (Block)
```json
{
  "id": "string",
  "name": "string",
  "x": "number",
  "y": "number", 
  "width": "number",
  "height": "number",
  "maxCapacity": "number",
  "actions": "Action[]",
  "connectionPoints": "ConnectionPoint[]"
}
```

### 5.2 액션 (Action)
```json
{
  "id": "string",
  "name": "string",
  "type": "delay|signal_update|signal_check|...",
  "parameters": "object"
}
```

### 5.3 연결 (Connection)
```json
{
  "from_block_id": "string",
  "from_connector_id": "string", 
  "to_block_id": "string",
  "to_connector_id": "string"
}
```

### 5.4 신호 (Signal)
```json
{
  "name": "string",
  "type": "boolean|string|number",
  "initialValue": "any",
  "currentValue": "any"
}
```

---

## 6. API 명세

### 6.1 시뮬레이션 실행
- **POST** `/simulation/run`
  - 입력: SimulationSetup
  - 출력: SimulationRunResult
  - 기능: 전체 시뮬레이션 실행

### 6.2 단계별 실행  
- **POST** `/simulation/step`
  - 입력: SimulationSetup (선택)
  - 출력: SimulationStepResult
  - 기능: 한 단계씩 시뮬레이션 실행

### 6.3 상태 초기화
- **POST** `/simulation/reset`
  - 입력: None
  - 출력: 성공/실패 메시지
  - 기능: 시뮬레이션 상태 초기화

---

## 7. 품질 요구사항

### 7.1 신뢰성
- **가용성**: 99.5% (월 3.6시간 이하 다운타임)
- **오류 처리**: 모든 API 호출에 대한 적절한 오류 응답
- **데이터 일관성**: 시뮬레이션 상태의 정확한 유지

### 7.2 사용성
- **학습 곡선**: 신규 사용자 30분 내 기본 조작 습득
- **효율성**: 기존 사용자 5분 내 간단한 시뮬레이션 생성
- **오류 복구**: 명확한 오류 메시지와 복구 가이드

### 7.3 확장성
- **기능 확장**: 새로운 액션 타입 추가 용이성
- **데이터 확장**: 더 많은 블록과 연결 지원
- **성능 확장**: 수직/수평 스케일링 가능

---

## 8. 보안 요구사항

### 8.1 데이터 보안
- CORS 설정으로 허용된 도메인에서만 접근
- 입력 데이터 검증 (Pydantic 기반)
- SQL 인젝션 방지 (ORM 사용 시)

### 8.2 운영 보안
- HTTPS 통신 (프로덕션 환경)
- 로그 기록 및 모니터링
- 정기적인 보안 업데이트

---

## 9. 제약사항

### 9.1 기술적 제약사항
- **단일 사용자**: 동시 편집 지원 안함
- **메모리 제한**: 대용량 시뮬레이션 시 성능 저하
- **브라우저 종속**: 최신 브라우저 기능 의존

### 9.2 비즈니스 제약사항
- **오픈소스**: 상용 라이브러리 사용 제한
- **개발 자원**: 소규모 팀 개발
- **배포 환경**: 온프레미스 우선

---

## 10. 향후 로드맵

### 10.1 단기 목표 (3개월)
- 다중 사용자 지원 (실시간 협업)
- 템플릿 시스템 구축
- 성능 최적화

### 10.2 중기 목표 (6개월)  
- 3D 시각화 지원
- 고급 통계 및 분석 기능
- 모바일 브라우저 지원

### 10.3 장기 목표 (12개월)
- AI 기반 공정 최적화 제안
- 실제 제조 시스템 연동 (IoT)
- 클라우드 서비스 제공

---

## 11. 성공 지표

### 11.1 기술적 지표
- **시뮬레이션 정확도**: 실제 공정 대비 95% 정확도
- **응답 시간**: API 응답 시간 100ms 이하
- **메모리 효율성**: 100개 블록 시뮬레이션 시 500MB 이하

### 11.2 사용자 지표
- **학습 시간**: 신규 사용자 30분 내 기본 기능 습득
- **작업 효율성**: 기존 도구 대비 50% 시간 단축
- **사용자 만족도**: NPS 점수 70점 이상

### 11.3 비즈니스 지표
- **도입률**: 목표 조직의 80% 도입
- **사용 빈도**: 주 3회 이상 사용
- **문제 해결률**: 시뮬레이션으로 80% 이상 공정 문제 사전 발견

---

*이 문서는 공정 시뮬레이션 웹 애플리케이션의 전체 요구사항을 정의하며, 개발팀과 이해관계자 간의 공통된 이해를 바탕으로 제품 개발을 진행하기 위한 기준 문서입니다.*